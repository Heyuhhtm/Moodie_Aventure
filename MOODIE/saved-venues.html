<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Saved Venues ‚Äî DilJourney</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@700&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="style.css">
  <style>
    /* Re-using styles from venues.html for consistency */
    .venues-header {
      padding: 120px 20px 40px;
      text-align: center;
      background: var(--surface);
      border-bottom: 1px solid var(--border);
    }
    .venues-header h1 {
      font-family: 'Cormorant Garamond', serif;
      font-size: 3rem;
      color: var(--text);
      margin-bottom: 10px;
    }
    .venues-header p {
      color: var(--muted);
      font-size: 1.1rem;
      max-width: 600px;
      margin: 0 auto;
    }
    .venues-container { max-width: 1200px; margin: 0 auto; padding: 40px 20px; }
    .venues-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 30px; }
    .venue-card { background: #fff; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.08); transition: transform 0.3s ease, box-shadow 0.3s ease; display: flex; flex-direction: column; }
    .venue-card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
    .venue-card-clickable { cursor: pointer; }
    .venue-card-image { width: 100%; height: 200px; object-fit: cover; background: #f0f0f0; }
    .venue-card-content { padding: 20px; flex-grow: 1; }
    .venue-card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
    .venue-card-title { font-size: 1.25rem; font-weight: 700; color: #1a1a2e; margin: 0; }
    .venue-card-rating { display: flex; align-items: center; gap: 5px; color: #f59e0b; font-weight: 600; }
    .venue-card-category { display: inline-block; padding: 4px 12px; background: #f3f4f6; color: #6b7280; border-radius: 12px; font-size: 0.8rem; text-transform: capitalize; margin-bottom: 10px; }
    .venue-card-address { color: #9ca3af; font-size: 0.9rem; margin-bottom: 15px; display: flex; align-items: center; gap: 5px; }
    .venue-card-moods { display: flex; flex-wrap: wrap; gap: 8px; }
    .venue-mood-tag { padding: 4px 10px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 10px; font-size: 0.75rem; text-transform: capitalize; }
    .venue-card-footer { padding: 15px 20px; border-top: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; }
    .venue-price { font-weight: 700; color: #10b981; }
    .venue-save-btn { padding: 8px 16px; background: transparent; border: 2px solid #667eea; color: #667eea; border-radius: 20px; cursor: pointer; transition: all 0.3s ease; font-weight: 600; }
    .venue-save-btn.saved { background: #D9534F; color: white; border-color: #D9534F; }
    .venue-save-btn.saved:hover { background: #c9302c; border-color: #c9302c; }
    .loading-spinner { display: flex; justify-content: center; align-items: center; padding: 60px; }
    .spinner { width: 50px; height: 50px; border: 4px solid #f3f3f3; border-top: 4px solid var(--accent); border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .no-venues { text-align: center; padding: 60px 20px; color: #6b7280; }
    .no-venues h3 { font-size: 1.5rem; margin-bottom: 10px; color: #1a1a2e; }
    .back-to-explore { display: inline-block; margin-top: 20px; padding: 12px 24px; background: var(--accent); color: white; text-decoration: none; border-radius: 25px; transition: background 0.3s ease; }
    .back-to-explore:hover { background: #c99a71; }
    .error-message { text-align: center; padding: 40px; color: #dc2626; background: #fef2f2; border-radius: 12px; margin: 20px; }
    
    /* Re-using user menu styles from dashboard.html */
    .user-menu { position: relative; display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 6px 12px; border-radius: 50px; transition: background 0.2s; }
    .user-menu:hover { background: rgba(166, 124, 82, 0.1); }
    .user-avatar { width: 36px; height: 36px; border-radius: 50%; background: linear-gradient(135deg, var(--accent), #c99a71); display: flex; align-items: center; justify-content: center; font-weight: 700; color: #fff; font-size: 0.9rem; }
    .user-name { font-size: 0.9rem; font-weight: 600; color: var(--text); }
    .user-dropdown { position: absolute; top: calc(100% + 10px); right: 0; background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 8px; min-width: 200px; opacity: 0; pointer-events: none; transform: translateY(-10px); transition: all 0.25s ease; box-shadow: 0 20px 40px rgba(0,0,0,0.1); z-index: 1000; }
    .user-menu:hover .user-dropdown { opacity: 1; pointer-events: all; transform: translateY(0); }
    .dropdown-header { padding: 12px 14px; border-bottom: 1px solid var(--border); margin-bottom: 8px; }
    .dropdown-header-name { font-weight: 700; font-size: 0.95rem; color: var(--text); }
    .dropdown-header-email { font-size: 0.8rem; color: var(--muted); margin-top: 2px; }
    .dropdown-item { display: flex; align-items: center; gap: 10px; padding: 10px 14px; color: var(--text); text-decoration: none; font-size: 0.9rem; border-radius: 10px; transition: background 0.2s; cursor: pointer; border: none; background: none; width: 100%; text-align: left; }
    .dropdown-item:hover { background: rgba(166, 124, 82, 0.1); }
    .dropdown-item.logout { color: #D9534F; }
    .dropdown-divider { height: 1px; background: var(--border); margin: 8px 0; }
  </style>
</head>
<body>

<!-- Mobile Menu -->
<div class="mobile-menu" id="mobileMenu">
  <button class="mobile-close" id="mobileClose">‚úï</button>
  <a href="index.html#how-it-works">How It Works</a>
  <a href="index.html#features">Features</a>
  <a href="Explore.html">Explore</a>
  <a href="dashboard.html">Dashboard</a>
  <a href="#" id="logout-btn-mobile" style="display:none; margin-top:10px;">Logout</a>
</div>

<!-- NAV -->
<nav>
  <a href="index.html" class="nav-logo">
    <img src="Explore_Component_Picture/Logo.png" alt="DilJourney Logo" class="nav-logo-img">
    <span><span class="logo-dil">Dil</span><span class="logo-journey">Journey</span></span>
  </a>
  <ul class="nav-links">
    <li><a href="Explore.html">Explore</a></li>
    <li>
      <div class="user-menu" id="userMenu">
        <div class="user-avatar" id="userAvatar">U</div>
        <span class="user-name" id="userName">User</span>
        <div class="user-dropdown">
          <div class="dropdown-header">
            <div class="dropdown-header-name" id="dropdownName">User Name</div>
            <div class="dropdown-header-email" id="dropdownEmail">user@email.com</div>
          </div>
          <a href="dashboard.html" class="dropdown-item">üè† Dashboard</a>
          <a href="profile.html" class="dropdown-item">üë§ My Profile</a>
          <a href="saved-venues.html" class="dropdown-item">üîñ Saved Places</a>
          <a href="#" class="dropdown-item">‚≠ê My Reviews</a>
          <div class="dropdown-divider"></div>
          <button class="dropdown-item logout" id="logout-btn">‚Ü© Log Out</button>
        </div>
      </div>
    </li>
  </ul>
  <button class="nav-hamburger" id="hamburger" aria-label="Open menu">
    <span></span><span></span><span></span>
  </button>
</nav>

<!-- Header -->
<header class="venues-header">
  <h1>My Saved Venues</h1>
  <p>Your personal collection of places that match your vibe. Revisit your favorites anytime.</p>
</header>

<!-- Venues Container -->
<main class="venues-container">
  <div id="venues-loading" class="loading-spinner">
    <div class="spinner"></div>
  </div>
  
  <div id="venues-error" class="error-message" style="display: none;">
    <h3>Oops! Something went wrong</h3>
    <p id="error-text">Unable to load your saved venues. Please try again later.</p>
    <button onclick="loadSavedVenues()" class="back-to-explore">Try Again</button>
  </div>
  
  <div id="venues-grid" class="venues-grid" style="display: none;">
    <!-- Venue cards will be dynamically inserted here -->
  </div>
  
  <div id="no-venues" class="no-venues" style="display: none;">
    <h3>No saved venues yet</h3>
    <p>You haven't saved any venues. Start exploring to find and save places you love!</p>
    <a href="Explore.html" class="back-to-explore">Explore Moods</a>
  </div>
</main>

<footer class="footer-simple">
  <div class="footer-inner">
    <div class="footer-bottom">
      <p>&copy; 2026 DilJourney. All rights reserved.</p>
    </div>
  </div>
</footer>

<!-- Scripts -->
<script src="js/config.js"></script>
<script src="js/api.js"></script>
<script src="js/auth.js"></script>
<script src="script.js"></script>
<script>
  // DOM Elements
  const loadingEl = document.getElementById('venues-loading');
  const errorEl = document.getElementById('venues-error');
  const gridEl = document.getElementById('venues-grid');
  const noVenuesEl = document.getElementById('no-venues');

  // Initialize
  document.addEventListener('DOMContentLoaded', () => {
    // Protect this page
    if (!window.auth || !window.auth.isAuthenticated()) {
      window.location.href = `account.html?form=login&returnUrl=${encodeURIComponent(window.location.pathname)}`;
      return;
    }
    
    // Populate user menu
    if (window.auth) {
        window.auth.updateUIForAuthenticatedUser();
    }

    loadSavedVenues();
  });

  async function loadSavedVenues() {
    loadingEl.style.display = 'flex';
    errorEl.style.display = 'none';
    gridEl.style.display = 'none';
    noVenuesEl.style.display = 'none';

    try {
      // Assuming getSavedVenues returns { success: true, venues: [...] }
      const response = await window.apiService.getSavedVenues();
      
      loadingEl.style.display = 'none';
      
      if (response.success && response.venues && response.venues.length > 0) {
        renderVenues(response.venues);
        gridEl.style.display = 'grid';
      } else {
        noVenuesEl.style.display = 'block';
      }
    } catch (error) {
      console.error('Error loading saved venues:', error);
      loadingEl.style.display = 'none';
      errorEl.style.display = 'block';
      document.getElementById('error-text').textContent = error.message || 'Failed to load saved venues';
    }
  }

  function renderVenues(venues) {
    gridEl.innerHTML = venues.map(venue => `
      <div class="venue-card" data-venue-id="${venue._id}">
        <div class="venue-card-clickable" onclick="viewVenue('${venue._id}')">
          <img src="${venue.images && venue.images[0] ? venue.images[0] : 'https://via.placeholder.com/400x200?text=No+Image'}" 
               alt="${venue.name}" 
               class="venue-card-image"
               onerror="this.src='https://via.placeholder.com/400x200?text=No+Image'">
          <div class="venue-card-content">
            <div class="venue-card-header">
              <h3 class="venue-card-title">${venue.name}</h3>
              <div class="venue-card-rating">
                <span>‚òÖ</span>
                <span>${venue.averageRating ? venue.averageRating.toFixed(1) : '0.0'}</span>
              </div>
            </div>
            <span class="venue-card-category">${venue.category}</span>
            <div class="venue-card-address">
              üìç ${venue.address}, ${venue.city}
            </div>
            <div class="venue-card-moods">
              ${venue.moods.map(m => `<span class="venue-mood-tag">${m}</span>`).join('')}
            </div>
          </div>
        </div>
        <div class="venue-card-footer">
          <span class="venue-price">${venue.priceRange}</span>
          <button class="venue-save-btn saved" onclick="unsaveVenue('${venue._id}', this)">
            Unsave
          </button>
        </div>
      </div>
    `).join('');
  }

  function viewVenue(venueId) {
    // This can be expanded to a details page later
    console.log('View venue:', venueId);
    // window.location.href = `venue-details.html?id=${venueId}`;
  }

  async function unsaveVenue(venueId, btn) {
    try {
      btn.textContent = 'Removing...';
      btn.disabled = true;
      await window.apiService.unsaveVenue(venueId);
      
      // Remove the card from the UI
      const card = btn.closest('.venue-card');
      card.style.transition = 'opacity 0.3s ease';
      card.style.opacity = '0';
      setTimeout(() => {
        card.remove();
        // Check if no venues are left
        if (gridEl.children.length === 0) {
          noVenuesEl.style.display = 'block';
        }
      }, 300);

    } catch (error) {
      console.error('Error unsaving venue:', error);
      btn.textContent = 'Unsave';
      btn.disabled = false;
      // Optionally show an error message to the user
    }
  }
</script>
</body>
</html>